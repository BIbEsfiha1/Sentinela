{% extends "base.html" %}
{% set active_page = "settings" %}
{% block title %}Configuracoes - Sentinela{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">Configuracoes</h1>
</div>

<div class="grid-2">
    <!-- Recording Settings -->
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Gravacao</h3>
        </div>
        <form id="recForm" onsubmit="saveRecording(event)">
            <div class="form-group">
                <label class="form-label">Duracao de cada bloco</label>
                <select class="form-select" name="segment_duration" id="segDuration">
                    <option value="300">5 minutos</option>
                    <option value="600">10 minutos</option>
                    <option value="900">15 minutos</option>
                    <option value="1800">30 minutos (recomendado)</option>
                    <option value="3600">1 hora</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">Manter gravacoes por</label>
                <select class="form-select" name="retention_days" id="retDays">
                    <option value="3">3 dias</option>
                    <option value="7">7 dias (recomendado)</option>
                    <option value="14">14 dias</option>
                    <option value="30">30 dias</option>
                    <option value="60">60 dias</option>
                    <option value="90">90 dias</option>
                </select>
            </div>
            <button type="submit" class="btn btn-primary w-full">Salvar</button>
        </form>
    </div>

    <!-- System Settings -->
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Sistema</h3>
        </div>
        <form id="sysForm" onsubmit="saveSystem(event)">
            <div class="form-group">
                <label class="form-label">Porta do servidor web</label>
                <input class="form-input" name="web_port" id="webPort" type="number" value="8080">
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Usuario padrao (cameras)</label>
                    <input class="form-input" name="default_username" id="defUser" value="admin">
                </div>
                <div class="form-group">
                    <label class="form-label">Senha padrao (cameras)</label>
                    <input class="form-input" name="default_password" id="defPass" type="password" value="12345678">
                </div>
            </div>
            <button type="submit" class="btn btn-primary w-full">Salvar</button>
        </form>
    </div>

    <!-- Remote Access -->
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Acesso Remoto</h3>
        </div>
        <div class="form-group">
            <label class="form-label">Modo</label>
            <select class="form-select" id="tunnelMode" onchange="toggleTunnelFields()">
                <option value="disabled">Desabilitado</option>
                <option value="quick">Rapido (URL temporaria, sem conta)</option>
                <option value="named">Fixo (requer conta Cloudflare gratuita)</option>
            </select>
        </div>
        <div id="tunnelFields" class="hidden">
            <div class="form-group" id="hostnameGroup" style="display:none">
                <label class="form-label">Hostname (ex: cameras.seudominio.com)</label>
                <input class="form-input" id="tunnelHostname" placeholder="cameras.seudominio.com">
            </div>
        </div>
        <div id="tunnelStatus" class="mb-2"></div>
        <div class="flex gap-1">
            <button class="btn btn-primary" onclick="saveTunnel()">Salvar</button>
            <button class="btn btn-secondary" id="tunnelToggle" onclick="toggleTunnel()">Iniciar</button>
        </div>
        <div id="tunnelUrl" class="mt-2 hidden">
            <div class="alert alert-success">
                <strong>URL de acesso remoto:</strong><br>
                <a id="tunnelLink" href="#" target="_blank" style="color:inherit;word-break:break-all"></a>
            </div>
        </div>
    </div>

    <!-- About -->
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Sobre</h3>
        </div>
        <p><strong>Sentinela</strong> v1.0</p>
        <p class="text-muted mt-1">Sistema de gravacao de cameras IP.</p>
        <p class="text-muted mt-1">Zero transcodificacao, leve e automatizado.</p>
        <div class="mt-2" id="sysInfo"></div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="/static/js/settings.js"></script>
{% endblock %}
